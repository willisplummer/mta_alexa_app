%h1 Activate your Amazon Echo
%p Welcome to my shitty form

%form{action: "activate", method: "post", id:"activateform", onsubmit: "return validateForm(this)"}
  %fieldset
    %ol
      %li
        %label{for: "activationcode"} Activation Code:
        %input{type: "text", name: "activationcode", class: "text"}
    %input{type: "submit", name: "submit", value: "Submit"}

%p{id:"errors"}
  %ul{id:"errorslist"}
    - if !locals[:errors].nil?
      - locals[:errors].each do |msg|
        %li
          = msg
        %br

:javascript
  function validateForm(form) {
    var errors = [];
    errors.push(validatePWLength(form));
    errors.push(validatePWMatch(form));
    errors.push(validateEmail(form));
    var filteredErrors = errors.filter(notNull);
    if (filteredErrors.length > 0) {
      printErrors(filteredErrors)
      return false;
    }
    else {
      return true;
    }
  };

  function printErrors(errors) {
    var arrayLength = errors.length;
    var htmlErrorsList = ""
    for (var i = 0; i < arrayLength; i++) {
      htmlErrorsList += '<li>' + errors[i] + '</li><br>';
    }
    document.getElementById("errorslist").innerHTML = htmlErrorsList;
  }

  function notNull(error) {
    return error != null;
  }

  function validatePWLength(form) {
    var length = form.pw1.value.length;
    if (6 <= length && length<= 20) {
      return;
    }
    else {
      return "Password must be more than 6 characters";
    }
  }

  function validatePWMatch(form) {
    if (form.pw1.value != form.pw2.value) {
      return "Passwords entered don't match";
    }
  }

  function validateEmail(form) {
    var length = form.email.value.length;
    if (4 <= length && length<= 20) {
      return;
    }
    else {
      return "Email must be between four and twenty characters";
    }
  }
